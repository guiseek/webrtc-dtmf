var E=Object.defineProperty;var h=(e,n,t)=>n in e?E(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var p=(e,n,t)=>(h(e,typeof n!="symbol"?n+"":n,t),t);const v=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}};v();function r(e,n=document.body){return n.querySelector(e)}function g(e,n=document.body){return n.querySelectorAll(e)}class x extends HTMLMenuElement{constructor(){super(...arguments);p(this,"keys",["1","2","3","4","5","6","7","8","9","*","0","#"]);p(this,"keyEvent",t=>{this.dispatchEvent(new KeyboardEvent("pressed",{bubbles:!0,composed:!0,key:t.value}))});p(this,"_state","disabled")}static get observedAttributes(){return["state"]}set state(t){this._state=t}get state(){return this._state}addKey(t){const c=document.createElement("li"),a=document.createElement("em"),s=document.createElement("button");return a.textContent=t,s.value=t,s.appendChild(a),c.appendChild(s),{li:c,button:s}}connectedCallback(){this.keys.forEach(t=>{const{li:c,button:a}=this.addKey(t);this.appendChild(c),a.onclick=()=>{this.keyEvent(a)}}),this.checkOnStateChange(this.state)}attributeChangedCallback(t,c,a){t==="state"&&a!==c&&this.checkOnStateChange(a)}checkOnStateChange(t){g("button",this).forEach(a=>{a.disabled=t==="disabled"})}disconnectedCallback(){g("button").forEach(t=>{t.removeEventListener("click",()=>{this.keyEvent(t)})})}}const y="virtual-keyboard",k=x,T={extends:"menu"};customElements.define(y,k,T);const o={keyboard:r("menu"),callButton:r("button#callButton"),sendTonesButton:r("button#sendTonesButton"),hangupButton:r("button#hangupButton"),durationInput:r("input#duration"),gapInput:r("input#gap"),tonesInput:r("input#tones"),durationValue:r("span#durationValue"),sentTonesInput:r("input#sentTones"),dtmfStatusDiv:r("div#dtmfStatus"),gapValue:r("span#gapValue"),audio:r("audio")};let d,i,u,l;const C={offerToReceiveAudio:!0,offerToReceiveVideo:!1};o.durationInput.oninput=()=>{o.durationValue.textContent=o.durationInput.value};o.gapInput.oninput=()=>{o.gapValue.textContent=o.gapInput.value};async function S(){q(),o.sendTonesButton.disabled=!0,o.hangupButton.disabled=!0,o.keyboard.setAttribute("state","disabled"),o.callButton.addEventListener("click",()=>L()),o.sendTonesButton.addEventListener("click",()=>R()),o.hangupButton.addEventListener("click",()=>B())}async function D(e){console.log("Fluxo local recebido"),u=e;const n=u.getAudioTracks();n.length>0&&console.log(`Usando dispositivo de \xE1udio: ${n[0].label}`),u.getTracks().forEach(t=>d.addTrack(t,u)),console.log("Adicionando fluxo local \xE0 conex\xE3o de peer");try{const t=await d.createOffer(C);await O(t)}catch(t){console.log("Falha ao criar a descri\xE7\xE3o da sess\xE3o:",t)}}async function L(){console.log("Iniciando chamada"),d=new RTCPeerConnection({}),console.log("Objeto de conex\xE3o de peer local criado pc1"),d.addEventListener("icecandidate",e=>m(d,e)),i=new RTCPeerConnection({}),console.log("Objeto de conex\xE3o de peer remoto criado pc2"),i.addEventListener("icecandidate",e=>m(i,e)),i.addEventListener("track",e=>A(e)),d.onconnectionstatechange=()=>{console.log("Estado da conex\xE3o de peer local:",d.connectionState)},i.onconnectionstatechange=()=>{console.log("Estado da conex\xE3o de peer remoto:",i.connectionState)},console.log("Solicitando transmiss\xE3o local");try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});await D(e)}catch(e){console.log("getUserMedia() error:",e)}o.callButton.disabled=!0,o.hangupButton.disabled=!1,o.sendTonesButton.disabled=!1}async function O(e){console.log(`Oferta do pc1
${e.sdp}`),d.setLocalDescription(e),i.setRemoteDescription(e);try{const n=await i.createAnswer();I(n)}catch(n){console.log("Falha ao criar a descri\xE7\xE3o da sess\xE3o:",n)}}function I(e){i.setLocalDescription(e),console.log(`Resposta do pc2:
${e.sdp}`),d.setRemoteDescription(e)}function B(){console.log("Encerrando chamada"),d.close(),i.close(),d=null,i=null,u=null,l=null,o.callButton.disabled=!1,o.hangupButton.disabled=!0,o.sendTonesButton.disabled=!0,o.keyboard.setAttribute("state","disabled"),o.dtmfStatusDiv.textContent="DTMF desativado"}function A(e){if(o.audio.srcObject!==e.streams[0]){if(o.audio.srcObject=e.streams[0],console.log("Fluxo remoto recebido"),!d.getSenders){alert("Esta demonstra\xE7\xE3o requer o m\xE9todo RTCPeerConnection getSenders() que n\xE3o \xE9 suportado por este navegador.");return}const t=d.getSenders().find(c=>c.track&&c.track.kind==="audio");if(!t){console.log(`Nenhuma faixa de \xE1udio local para enviar DTMF com
`);return}if(!t.dtmf){alert("Esta demonstra\xE7\xE3o requer DTMF que n\xE3o \xE9 suportado por este navegador.");return}l=t.dtmf,o.dtmfStatusDiv.textContent="DTMF dispon\xEDvel",console.log(`Obteve DTMFSender
`),l.ontonechange=w,o.keyboard.state==="disabled"&&o.keyboard.setAttribute("state","enabled")}}function M(e){return e===d?i:d}function F(e){return e===d?"pc1":"pc2"}async function m(e,n){try{n.candidate&&(await M(e).addIceCandidate(n.candidate),console.log(`${F(e)} ICE candidate: ${n.candidate?n.candidate.candidate:"(null)"}`))}catch(t){console.log("Error adding ice candidate:",t)}}function w(e){e&&(console.log(`Enviado tom DTMF: ${e.tone}`),o.sentTonesInput.value+=`${e.tone} `)}function b(e){if(l&&l.canInsertDTMF){const n=o.durationInput.valueAsNumber,t=o.gapInput.valueAsNumber;console.log("Tons, dura\xE7\xE3o, intervalo: ",e,n,t),l.insertDTMF(e,n,t)}}function R(){b(o.tonesInput.value)}function q(){o.keyboard.addEventListener("pressed",e=>b(e.key))}document.addEventListener("DOMContentLoaded",S);
